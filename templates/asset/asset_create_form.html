{% load crispy_forms_tags %}

<div id="CreateAssetModal" class="modal fade">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title">Create New Asset</h1>
            </div>
            <div class="modal-body">
                <form id="CreateAssetForm" method="POST">
                    {% csrf_token %}
                    <div id="FormGroup" class="form-group">
                        {{ form| crispy }}
                    </div>
                    <button class="btn btn-success" type="submit">Create</button>
                </form>
            </div>
            <div class="modal-footer">
                <!-- Here we create this empty div for alert messages -->
                <div style="float: left; margin: 5px;" id="message-div"></div>
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<script>

    var form_id = $("#CreateAssetForm");

    form_id.on('submit', function (event) {
        event.preventDefault();
        console.log("form submitted!")  // sanity check
        {#$("node-2").children("df-text").va#}
    });


    {#// AJAX for posting#}

    function create_asset() {
        $.ajax({
            url: "{% url 'asset_create_post' %}",
            type: "POST",
            data: form_id.serialize(),
            success: function (data) {
                if (!(data['success'])) {
                    console.log("form errors!")
                    // Here we replace the form, for the errors to show
                    form_id.find($("#FormGroup")).replaceWith($(data['form_html']));

                } else {
                    console.log("success!")
                    //Remove fields to prevent accidental resubmission
                    {% for field in form %}
                        $('#' + '{{ field.auto_id}}').val(''); // remove the values from the inputs
                    {% endfor %}
                    //Show the success message
                    $('#message-div').html("<div class='alert-success'>" +
                        "<strong>Success: </strong>New asset was created </div>");
                    location.reload();
                }
            },
            error: function (xhr, errmsg) {
                console.log("backend_error!")
                //Show the error message
                $('#message-div').html("<div class='alert-error'>" +
                    "<strong>Success: </strong> We have encountered an error: " + errmsg + "</div>");
            }
        });


    };

    //Reload page when modal closes
    $('#CreateAssetModal').on('hide.bs.modal', function () {
        console.log("reload!")  // sanity check
        location.reload();

    });

</script>